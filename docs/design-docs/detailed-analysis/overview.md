# 詳細分析機能 - 機能概要

## 機能概要

詳細分析機能は、既存農家が蓄積した作業記録・売上記録・コスト記録を基に、長期的な視点での経営分析と改善提案を提供する機能です。作業効率やコスト構造を詳細に分析し、AIによる具体的な改善インサイトを提供することで、データドリブンな経営改善を支援します。

## 目的

### 主要目的
1. **長期分析の実現**: 作業・コストの長期的な推移と傾向の可視化
2. **効率性の把握**: 作業効率指標とコスト効率の定量的な評価
3. **改善機会の発見**: データに基づいた具体的な改善ポイントの特定
4. **AI支援による洞察**: 人間では気づきにくいパターンや改善提案の提供

### 解決する課題
- 短期的な売上分析だけでは見えない、長期的な経営課題の把握困難
- 作業効率やコスト効率の客観的な評価方法がない
- 膨大なデータから有意な改善ポイントを見つけることの困難
- 経験則に頼った改善で、データに基づいた最適化ができていない

## 対象ユーザー

- **既存農家**: 継続的にデータを蓄積している農家
- **経営改善志向の農家**: より効率的な農業経営を目指す農家
- **データドリブン経営希望者**: データに基づいた意思決定を行いたい農家

## 主要機能

### 1. 作業の長期分析

#### 1.1 作業時間推移分析
- **機能**: 週単位・月単位での作業時間の推移を可視化
- **データソース**: 日々の記録モーダルの作業データ
- **表示形式**: 積み上げ棒グラフ、折れ線グラフ
- **分析観点**: 
  - 「7月は除草に多く時間がかかっている」
  - 「収穫期は作業が集中している」
  - 季節性・周期性の把握

#### 1.2 作業内容別比率分析
- **機能**: 作業種別ごとの時間配分を円グラフで表示
- **データ例**: 除草30%、収穫40%、施肥20%、出荷準備10%
- **比較機能**: 期間別比較、前年同期比較
- **表示形式**: ドーナツチャート、比較バーチャート

#### 1.3 作業効率指標
- **機能**: 作業効率を定量的に評価
- **計算式**:
  - 作業効率 = 作業時間 ÷ 出荷量
  - 人件費効率 = 人件費 ÷ 売上
  - 時間当たり売上 = 売上 ÷ 作業時間
- **表示形式**: 指標カード、推移グラフ

### 2. コストの長期分析

#### 2.1 月別コスト推移
- **機能**: カテゴリ別コストの月別推移を可視化
- **カテゴリ**: 肥料・農薬・人件費・設備費・その他
- **表示形式**: 積み上げ棒グラフ、折れ線グラフ
- **データソース**: 日々の記録モーダルのコストデータ

#### 2.2 売上対比コスト分析
- **機能**: 売上とコストを併せて表示し、利益率を可視化
- **分析観点**: 
  - 「8月は売上は増えたが肥料代が急増し利益率が低下」
  - 月別利益率の推移
  - コスト比率の変化
- **表示形式**: 複合グラフ（売上+コスト+利益率）

#### 2.3 コスト構造分析
- **機能**: コスト構成比の詳細分析
- **表示形式**: 円グラフ、サンキーダイアグラム
- **比較機能**: 期間比較、業界平均との比較

### 3. 改善インサイト（AI提案機能）

#### 3.1 自動気づき生成
- **機能**: AIが自動でデータのパターンを検知し、気づきを提供
- **分析対象**: 
  - 作業効率の変化
  - コスト構造の異常
  - 収益性の変動要因
- **提案例**:
  - 「除草にかける時間が昨年比+25% → 作業効率が低下」
  - 「7月は利益率が最も低い → コスト構造を見直す必要あり」
  - 「出荷ピークを1週間ずらせば単価+10%の可能性」

#### 3.2 改善提案の生成
- **機能**: 具体的な改善アクションを提案
- **提案タイプ**:
  - 作業効率改善（作業時間短縮、作業配分最適化）
  - コスト削減（コスト構造改善、タイミング最適化）
  - 収益向上（販売時期調整、価格戦略）
- **根拠表示**: データに基づいた改善効果の試算

#### 3.3 目標設定・追跡
- **機能**: ユーザーが設定した目標と実績の比較
- **目標種類**:
  - 作業効率目標（時間短縮率等）
  - コスト削減目標（コスト比率等）
  - 売上・利益目標
- **追跡機能**: 目標達成度の可視化、進捗アラート

## データ連動

### 入力データソース
1. **作業記録**: 日々の記録モーダルの作業データ
2. **売上記録**: 売上分析・データ管理機能の売上データ
3. **コスト記録**: 日々の記録モーダルのコストデータ
4. **目標設定**: ユーザーが設定する目標値

### データ形式
```typescript
// 作業記録
interface WorkRecord {
  date: string          // 作業日
  workType: string     // 作業種別（除草、収穫、施肥等）
  duration: number     // 作業時間（分）
  crop: string         // 対象作物
  notes?: string       // メモ
}

// コスト記録
interface CostRecord {
  date: string          // 発生日
  category: string     // カテゴリ（肥料、農薬、人件費等）
  amount: number       // 金額
  description: string  // 内容説明
  crop?: string        // 対象作物（任意）
}

// 目標設定
interface Target {
  id: string           // 目標ID
  type: 'efficiency' | 'cost' | 'revenue'  // 目標種別
  description: string  // 目標説明
  targetValue: number  // 目標値
  currentValue: number // 現在値
  deadline: string     // 期限
  status: 'active' | 'achieved' | 'missed'  // ステータス
}
```

## UI/UX要件

### アクセス方法
- **ダッシュボードから**: 「詳細分析」クイックアクションボタン
- **独立ページ**: `/existing-farmer/detailed-analysis`
- **売上分析から**: 「より詳細な分析」リンク

### レイアウト構成
1. **ヘッダー**: ページタイトル、戻るボタン、期間選択
2. **サマリーエリア**: 重要指標の概要表示
3. **分析エリア**: 3列グリッドレイアウト
   - 左列: 作業分析（作業時間推移、作業効率指標）
   - 中列: コスト分析（コスト推移、利益率分析）
   - 右列: 改善インサイト（AI提案、目標追跡）
4. **詳細エリア**: 各分析の詳細表示

### デザイン指針
- **統一性**: 既存の売上分析・データ管理機能とのUI統一
- **カラーパレット**: 既存のSprout Green、Sky Blue、Harvest Yellow等を使用
- **情報密度**: 豊富な情報を整理して表示（情報過多を避ける）
- **インタラクティブ**: ドリルダウン、フィルタリング機能

### インタラクション
- **期間選択**: 月単位、四半期単位、年単位での分析
- **作物フィルター**: 特定作物に絞った分析
- **ドリルダウン**: 概要から詳細への段階的な分析
- **比較機能**: 期間比較、前年同期比較

## 技術要件

### 使用技術
- **フレームワーク**: Next.js 15 + TypeScript
- **グラフライブラリ**: Recharts
- **AIライブラリ**: OpenAI API（改善インサイト生成）
- **UIコンポーネント**: 既存のshadcn/ui
- **データ処理**: カスタムフック + useMemo最適化

### パフォーマンス要件
- **データ処理**: 1年分のデータ（約1,000件）を5秒以内で処理
- **AI分析**: 改善インサイト生成を10秒以内で完了
- **グラフ描画**: 全グラフの初期表示を3秒以内で完了
- **フィルタ反応**: 条件変更時の再描画を1秒以内で完了

## 成功指標

### 機能完成の定義
1. ✅ 作業時間推移分析の表示
2. ✅ 作業効率指標の計算・表示
3. ✅ コスト推移分析の表示
4. ✅ 売上対比コスト分析の表示
5. ✅ AI改善インサイトの生成・表示
6. ✅ 目標設定・追跡機能
7. ✅ データフィルタリング・比較機能

### ユーザビリティ目標
- **有用性**: 実際の経営改善に活用できる具体的な示唆を提供
- **理解性**: 複雑なデータを分かりやすく可視化
- **実行性**: 提案された改善策が実際に実行可能
- **継続性**: 定期的な分析習慣の形成を促進

## フェーズ別実装計画

### Phase 1: 基本分析機能（実装優先度：高）
- 作業時間推移分析
- コスト推移分析
- 基本的な効率指標

### Phase 2: AI機能・高度分析（実装優先度：中）
- AI改善インサイト生成
- 目標設定・追跡機能
- より詳細な比較分析

## 将来拡張

### Phase 3での拡張予定
- **予測分析**: 将来の作業負荷・コスト予測
- **ベンチマーク比較**: 地域農家・同規模農家との比較
- **自動レポート**: 定期的な分析レポートの自動生成
- **モバイル対応**: スマートフォンでの分析確認

### 外部連携拡張
- **IoTデバイス連携**: 自動作業時間記録
- **気象データ連携**: 天候と作業効率の相関分析
- **市場データ連携**: 価格変動と収益性の分析

---

**作成日**: 2024年12月  
**最終更新**: 2024年12月  
**実装予定**: Phase 1→2024年12月、Phase 2→2025年1月
