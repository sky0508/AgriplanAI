# 売上分析機能 - 機能概要

## 機能概要

売上分析機能は、既存農家が日々の記録モーダルで蓄積した売上データを分析・可視化し、経営改善の意思決定を支援する機能です。品目別売上推移と販売チャンネル別分析を中心とした分析機能を提供します。

## 目的

### 主要目的
1. **売上データの可視化**: 蓄積された売上記録を分かりやすいグラフで表示
2. **収益性の把握**: 品目・チャンネル別の収益性比較による最適化支援
3. **意思決定支援**: データに基づいた栽培・販売戦略の策定支援

### 解決する課題
- 売上データが記録のみで終わってしまい、分析に活用できていない
- 品目別・チャンネル別の収益性が把握できず、最適化の方向性が見えない
- 感覚的な判断ではなく、データに基づいた経営判断を行いたい

## 対象ユーザー

- **既存農家**: 日々の記録を蓄積している農家
- **経営分析を行いたい農家**: データドリブンな経営改善を目指す農家

## 主要機能

### 1. 品目別売上推移分析
- **機能**: 各作物の月別・期間別売上推移をグラフで表示
- **データソース**: 日々の記録モーダルの売上データ
- **表示形式**: 折れ線グラフ、棒グラフ
- **フィルタ**: 期間選択、品目選択

### 2. 販売チャンネル別分析
- **機能**: 販売先（よ市・産直等）別の売上・収益性分析
- **データソース**: 日々の記録モーダルの売上データ
- **表示形式**: 棒グラフ、円グラフ
- **分析内容**: チャンネル別売上比率、単価比較

### 3. 作物別売上構成比
- **機能**: 全体売上に占める各作物の割合を可視化
- **表示形式**: 円グラフ（ドーナツチャート）
- **データ**: 期間内の品目別売上合計

### 4. 売上・コスト比較分析
- **機能**: 売上とコストを併せて表示し、粗利を可視化
- **表示形式**: 複合グラフ（売上棒グラフ + コスト線グラフ）
- **計算**: 粗利 = 売上 - コスト

## データ連動

### 入力データ
- **ソース**: 日々の記録モーダル（`components/daily-record-modal.tsx`）の売上記録
- **データ形式**:
```typescript
interface SalesRecord {
  date: string          // 販売日
  crop: string         // 作物名
  quantity: number     // 数量（kg）
  unitPrice: number    // 単価（円/kg）
  total: number        // 合計金額
  buyer: string        // 販売先（よ市/産直等）
  notes?: string       // メモ
}
```

### サンプルデータ設定
```typescript
const sampleData = [
  // 葡萄 - よ市
  { date: '2024-11-01', crop: 'grape', quantity: 50, unitPrice: 300, buyer: 'wholesale_market' },
  { date: '2024-11-05', crop: 'grape', quantity: 30, unitPrice: 300, buyer: 'wholesale_market' },
  
  // 葡萄 - 産直
  { date: '2024-11-03', crop: 'grape', quantity: 20, unitPrice: 400, buyer: 'direct_sales' },
  { date: '2024-11-07', crop: 'grape', quantity: 25, unitPrice: 400, buyer: 'direct_sales' },
  
  // じゃがいも - よ市
  { date: '2024-11-02', crop: 'potato', quantity: 100, unitPrice: 150, buyer: 'wholesale_market' },
  
  // じゃがいも - 産直
  { date: '2024-11-04', crop: 'potato', quantity: 80, unitPrice: 200, buyer: 'direct_sales' }
]
```

## UI/UX要件

### レイアウト構成
1. **ヘッダー**: ページタイトル、戻るボタン
2. **フィルターエリア**: 期間選択、品目選択、チャンネル選択
3. **メイングラフエリア**: 2列グリッドレイアウト
   - 左上: 品目別売上推移グラフ
   - 右上: 販売チャンネル別分析
   - 左下: 作物別売上構成比（円グラフ）
   - 右下: 売上・コスト比較分析

### デザイン指針
- **既存画面との統一**: `forecast/page.tsx` のレイアウトを参考
- **カラーパレット**: 既存のSprout Green、Sky Blue、Harvest Yellow等を使用
- **レスポンシブ対応**: モバイル時は1列レイアウトに変更

### インタラクション
- **フィルター変更**: リアルタイムでグラフ更新
- **グラフ詳細**: ホバー時の詳細情報表示
- **期間選択**: 月別、四半期別、年別の切り替え

## 技術要件

### 使用技術
- **フレームワーク**: Next.js 15 + TypeScript
- **グラフライブラリ**: Recharts
- **UIコンポーネント**: 既存のshadcn/ui
- **データ管理**: React状態管理（useState/useEffect）

### パフォーマンス要件
- **データ処理**: 1,000件程度の売上記録を即座に処理
- **グラフ描画**: 3秒以内でのレンダリング完了
- **フィルタ反応**: 1秒以内でのグラフ更新

## 成功指標

### 機能完成の定義
1. ✅ 品目別売上推移グラフの表示
2. ✅ 販売チャンネル別分析の表示
3. ✅ 作物別売上構成比（円グラフ）の表示
4. ✅ 売上・コスト比較分析の表示
5. ✅ フィルター機能の動作
6. ✅ 日々の記録データとの連動

### ユーザビリティ目標
- **直感性**: 初回利用時に説明なしでグラフが理解できる
- **実用性**: 実際の経営判断に活用できる情報を提供
- **継続性**: 日々の記録入力のモチベーション向上に寄与

## 将来拡張

### Phase 2での拡張予定
- **詳細分析**: 収益率、ROI分析
- **比較機能**: 前年同期比、計画値との比較
- **予測機能**: 売上トレンド予測
- **エクスポート**: CSV、PDF出力機能

---

**作成日**: 2024年12月  
**最終更新**: 2024年12月
